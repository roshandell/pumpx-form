<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PumpX â€” AI Token Launcher (PXPX Ready)</title>
<link rel="preconnect" href="https://esm.sh"/>
<style>
  :root{--bg:#0b0f1a;--card:#0f1524;--line:#334466;--accent:#79d9ff}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#fff;font-family:Inter,system-ui,"Noto Sans Arabic",sans-serif}
  a{color:var(--accent);text-decoration:none}
  .wrap{max-width:1200px;margin:auto;padding:20px}
  .nav{position:sticky;top:0;z-index:40;background:#0b0f1acc;border-bottom:1px solid #ffffff22;backdrop-filter:blur(8px)}
  .navin{display:flex;gap:10px;justify-content:space-between;align-items:center;height:64px}
  .tabs{display:flex;gap:8px;flex-wrap:wrap}
  .tab{padding:10px 14px;border-radius:12px;border:1px solid #ffffff22;background:#121a2c;cursor:pointer}
  .tab.active{background:#1b2744}
  .btn{background:linear-gradient(90deg,#12f0ff44,#7a5cff33,#ff3ef633);border:1px solid #ffffff22;padding:10px 14px;border-radius:12px;color:#fff;cursor:pointer}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .select,.input,.textarea{background:#121a2c;border:1px solid var(--line);color:#fff;border-radius:12px;padding:10px 12px}
  .textarea{min-height:90px;resize:vertical}
  .card{background:#0f1524;border:1px solid #ffffff22;border-radius:18px;padding:16px;margin:14px 0}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .muted{opacity:.8;font-size:13px}
  .code{background:#0b0f1a;border:1px solid #445;border-radius:10px;padding:8px 10px;word-break:break-all}
  .kpis{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
  @media(max-width:900px){.kpis{grid-template-columns:repeat(2,minmax(0,1fr))}}
  .kpi{background:#0f1524;border:1px solid #ffffff22;border-radius:16px;padding:12px}
  .badge{display:inline-block;padding:4px 8px;border:1px solid #ffffff22;border-radius:999px;background:#ffffff10;font-size:12px;margin-inline-start:6px}
  .list{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
  @media(max-width:1000px){.list{grid-template-columns:repeat(2,minmax(0,1fr))}}
  @media(max-width:720px){.list{grid-template-columns:1fr}}
  .card-sm{background:#10172a;border:1px solid #ffffff22;border-radius:14px;padding:12px}
  footer{margin:40px 0;opacity:.7;font-size:13px}
</style>
</head>
<body>
<div class="nav">
  <div class="wrap navin">
    <div class="row">
      <div style="font-weight:900;letter-spacing:.12em">PumpX</div>
      <span class="badge">Pro</span>
    </div>
    <div class="row">
      <select id="network" class="select">
        <option value="devnet" selected>Devnet</option>
        <option value="mainnet-beta">Mainnet</option>
      </select>
      <button id="connect" class="btn">Ø§ØªØµØ§Ù„ Ú©ÛŒÙ</button>
      <button id="disconnect" class="btn" style="display:none">Ù‚Ø·Ø¹</button>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="tabs">
    <div class="tab active" data-page="create">Ø³Ø§Ø®Øª ØªÙˆÚ©Ù†</div>
    <div class="tab" data-page="explore">Ø¯Ø± Ø­Ø§Ù„ Ø±Ø´Ø¯</div>
    <div class="tab" data-page="swap">Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´</div>
    <div class="tab" data-page="ai">Ø¯Ø³ØªÛŒØ§Ø± AI</div>
    <div class="tab" data-page="support">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</div>
  </div>

  <div class="kpis">
    <div class="kpi"><div class="muted">Provider</div><div id="prov" class="code">â€”</div></div>
    <div class="kpi"><div class="muted">Ø¢Ø¯Ø±Ø³</div><div id="addr" class="code">â€”</div></div>
    <div class="kpi"><div class="muted">Ù…ÙˆØ¬ÙˆØ¯ÛŒ SOL</div><div id="bal" class="code">â€”</div></div>
    <div class="kpi"><div class="muted">RPC ÙØ¹Ø§Ù„</div><div id="rpcUsing" class="code">â€”</div></div>
  </div>

  <!-- CREATE -->
  <section id="page-create" class="card">
    <h2 style="margin:0 0 10px">Ø³Ø§Ø®Øª ØªÙˆÚ©Ù† (SPL) + Ù…ØªØ§Ø¯ÛŒØªØ§ (IPFS)</h2>
    <div class="row" style="gap:8px;flex-wrap:wrap;margin-bottom:10px">
      <button id="pxpx" class="btn">ğŸš€ Launch PumpX (PXPX)</button>
      <span class="muted">Ø¨Ø§ Ø§ÛŒÙ† Ø¯Ú©Ù…Ù‡ØŒ Ù„ÙˆÚ¯ÙˆÛŒ PumpX Ùˆ JSON Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ ØªÙˆÚ©Ù† PXPX Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</span>
    </div>

    <div class="grid">
      <label>Ù†Ø§Ù…<input id="name" class="input" value="PumpX Token"></label>
      <label>Ù†Ù…Ø§Ø¯<input id="symbol" class="input" value="PXPX"></label>
      <label>Decimals<input id="decimals" class="input" type="number" min="0" max="9" value="9"></label>
      <label>Ø¹Ø±Ø¶Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ (ÙˆØ§Ø­Ø¯ Ø§Ù†Ø³Ø§Ù†ÛŒ)<input id="supply" class="input" type="number" value="1000000000"></label>
      <label>Ø¢ÛŒÚ©ÙˆÙ† (PNG/SVG/JPG)<input id="icon" class="input" type="file" accept=".png,.svg,.jpg,.jpeg"/></label>
      <label>NFT.Storage Token<input id="nftkey" class="input" placeholder="Ø¨Ø±Ø§ÛŒ IPFS/Ù…ØªØ§Ø¯ÛŒØªØ§"/></label>
      <label style="grid-column:1/-1">ØªÙˆØ¶ÛŒØ­/Story (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)<textarea id="story" class="textarea"></textarea></label>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="createToken" class="btn" disabled>ğŸª™ Ø³Ø§Ø®Øª ØªÙˆÚ©Ù†</button>
      <button id="lock" class="btn" disabled>ğŸ”’ Ù‚ÙÙ„ Mint Authority</button>
      <span id="status" class="muted"></span>
    </div>
    <div id="result" class="card" style="display:none;margin-top:12px"></div>
  </section>

  <!-- EXPLORE -->
  <section id="page-explore" class="card" style="display:none">
    <h2 style="margin:0 0 10px">ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø´Ø¯ (Ù…Ø­Ù„ÛŒ)</h2>
    <div class="row">
      <button id="refreshLocal" class="btn">ğŸ”„ Ø±ÙØ±Ø´</button>
      <span class="muted">Ø±Ø¬ÛŒØ³ØªØ±ÛŒ Ø¬Ù‡Ø§Ù†ÛŒ Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡â€ŒÛŒ Ø¨Ø¹Ø¯ Ø¨Ø§ Supabase/Helius Indexer.</span>
    </div>
    <div id="explist" class="list" style="margin-top:12px"></div>
  </section>

  <!-- SWAP -->
  <section id="page-swap" class="card" style="display:none">
    <h2 style="margin:0 0 10px">Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´ â€” Jupiter</h2>
    <div id="swapBox" class="card-sm" style="height:620px">
      <iframe id="jup" src="https://jup.ag/swap/SOL" style="width:100%;height:600px;border:0;border-radius:12px;background:#0b0f1a"></iframe>
    </div>
    <div class="row">
      <label style="flex:1">Ø¢Ø¯Ø±Ø³ ØªÙˆÚ©Ù† Ø´Ù…Ø§
        <input id="swapMint" class="input" placeholder="Mint address"/>
      </label>
      <button id="setSwap" class="btn">ØªÙ†Ø¸ÛŒÙ… Ø¬ÙØª SOL â†”ï¸ Token</button>
      <button id="setPXPX" class="btn">SOL â†”ï¸ PXPX</button>
    </div>
  </section>

  <!-- AI -->
  <section id="page-ai" class="card" style="display:none">
    <h2 style="margin:0 0 10px">Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</h2>
    <div class="grid">
      <label>OpenAI API Key (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)<input id="openai" class="input" placeholder="sk-..."/></label>
      <label>ØªÙ…/Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§<input id="theme" class="input" value="Ù…ÛŒÙ…ØŒ Ø¬Ù‡Ø§Ù†ÛŒØŒ Ù†Ø¦ÙˆÙ†ÛŒ"/></label>
      <label style="grid-column:1/-1">Ù…ØªÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª/Ø±ÙˆØ¯Ù…Ù¾
        <textarea id="desc" class="textarea"></textarea>
      </label>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="aiBrand" class="btn">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù†Ø§Ù…/Ù†Ù…Ø§Ø¯/Story</button>
      <button id="aiRisk" class="btn">ØªØ­Ù„ÛŒÙ„ Ø±ÛŒØ³Ú©/Ø§Ø¹ØªÙ…Ø§Ø¯</button>
      <span id="aiStatus" class="muted"></span>
    </div>
    <div id="riskOut" class="card-sm" style="display:none;margin-top:10px"></div>
  </section>

  <!-- SUPPORT -->
  <section id="page-support" class="card" style="display:none">
    <h2 style="margin:0 0 10px">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</h2>
    <p>Ø§ÛŒÙ…ÛŒÙ„: <a href="mailto:support@pumpx.info">support@pumpx.info</a></p>
    <p class="muted">Ø³Ø§Ø¹Ø§Øª Ù¾Ø§Ø³Ø®â€ŒÚ¯ÙˆÛŒÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ: Û²Û° Ø³Ø§Ø¹Øª. Ø³Ù„Ø¨ Ù…Ø³Ø¦ÙˆÙ„ÛŒØª: PumpX Ø¨Ø³ØªØ±ÛŒ ÙÙ†ÛŒ Ø§Ø³Øª Ùˆ Ù‚ÙˆÙ„ Ø³ÙˆØ¯ Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
  </section>

  <footer>Â© <span id="year"></span> PumpX â€” Create â€¢ Launch â€¢ Grow</footer>
</div>

<script type="module">
/* ---------- Imports ---------- */
import { Connection, clusterApiUrl, PublicKey } from "https://esm.sh/@solana/web3.js@1.95.3";
import { createMint, getOrCreateAssociatedTokenAccount, mintTo, setAuthority, AuthorityType, TOKEN_PROGRAM_ID } from "https://esm.sh/@solana/spl-token@0.4.6?bundle";
import { createUmi } from "https://esm.sh/@metaplex-foundation/umi-bundle-defaults@0.8.10";
import { publicKey as umiPk, signerIdentity } from "https://esm.sh/@metaplex-foundation/umi@0.8.10";
import { createV1 } from "https://esm.sh/@metaplex-foundation/mpl-token-metadata@3.1.2";

/* ---------- Helpers & UI ---------- */
const $=id=>document.getElementById(id); $("year").textContent=new Date().getFullYear();
document.querySelectorAll(".tab").forEach(t=>{t.onclick=()=>{document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));t.classList.add("active");const pg=t.dataset.page;document.querySelectorAll("section[id^='page-']").forEach(s=>s.style.display="none");$("page-"+pg).style.display="block";};});
const provEl=$("prov"),addrEl=$("addr"),balEl=$("bal"),rpcUsingEl=$("rpcUsing"),statusEl=$("status");

/* ---------- Hidden RPC (your Helius) ---------- */
const HELIUS_MAINNET_URL="https://mainnet.helius-rpc.com/?api-key=b553d42b-55cd-48ca-bf99-e81ff18ef4d6";
const RPCS={ "devnet":[clusterApiUrl("devnet"),"https://api.devnet.solana.com"], "mainnet-beta":[HELIUS_MAINNET_URL,clusterApiUrl("mainnet-beta"),"https://api.mainnet-beta.solana.com"] };
let network="devnet"; let connection=new Connection(RPCS[network][0],"confirmed"); rpcUsingEl.textContent=RPCS[network][0];

/* ---------- Wallet ---------- */
let provider=null, wallet=null;
function getProvider(){const w=window; if(w?.phantom?.solana?.isPhantom) return w.phantom.solana; if(w?.solana?.isPhantom) return w.solana; if(w?.solflare) return w.solflare; if(w?.solana?.isSolflare) return w.solana; return null;}
$("network").onchange=async e=>{network=e.target.value; connection=new Connection(RPCS[network][0],"confirmed"); rpcUsingEl.textContent=RPCS[network][0]; await refreshBalance();};
$("connect").onclick=async()=>{provider=getProvider(); provEl.textContent=provider?"OK âœ…":"Not found âŒ"; if(!provider) return alert("Phantom ÛŒØ§ Solflare Ù†ØµØ¨/Ø¨Ø§Ø² Ø´ÙˆØ¯."); try{const r=await(provider.connect?provider.connect():provider.request({method:"connect"})); wallet=r?.publicKey?.toString?.()||provider.publicKey?.toString?.(); addrEl.textContent=wallet||"â€”"; $("connect").style.display="none"; $("disconnect").style.display="inline-block"; $("createToken").disabled=false; await refreshBalance(); }catch(e){statusEl.textContent=e?.message||e;}};
$("disconnect").onclick=async()=>{try{await provider?.disconnect?.();}catch{} wallet=null; addrEl.textContent="â€”"; balEl.textContent="â€”"; $("connect").style.display="inline-block"; $("disconnect").style.display="none";};

/* ---------- Balance with fallback ---------- */
async function tryBalance(url,pk){const conn=new Connection(url,"confirmed"); rpcUsingEl.textContent=url; try{return await conn.getBalance(pk);}catch{const i=await conn.getAccountInfo(pk); return i?.lamports??0;}}
async function safeBalance(pk){let last; for(const url of RPCS[network]){try{return await tryBalance(url,pk);}catch(e){last=e;}} throw last;}
async function refreshBalance(){ if(!wallet){balEl.textContent="â€”";return;} balEl.textContent="â€¦"; try{const lamports=await safeBalance(new PublicKey(wallet)); balEl.textContent=(lamports/1e9).toFixed(6);}catch{balEl.textContent="Ø®Ø·Ø§";}}

/* ---------- NFT.Storage Upload ---------- */
async function uploadNFTStorage(blob,token){const r=await fetch("https://api.nft.storage/upload",{method:"POST",headers:{"Authorization":"Bearer "+token},body:blob}); const j=await r.json(); if(!j.ok) throw new Error("NFT.Storage failed"); return "ipfs://"+j.value.cid;}

/* ---------- Embedded PumpX SVG (brand icon) ---------- */
function pumpxSVG() {
  // Ù„ÙˆÚ¯ÙˆÛŒ Ø³Ø§Ø¯Ù‡ Ùˆ ØªÙ…ÛŒØ² (Ø³Ø¨Ú© Ø¢Ø¨ÛŒ-Ø®Ø§Ú©Ø³ØªØ±ÛŒ)
  const svg = `
  <svg xmlns="http://www.w3.org/2000/svg" width="1024" height="1024" viewBox="0 0 1024 1024">
    <rect width="1024" height="1024" fill="#0b0f1a"/>
    <g transform="translate(128,128)">
      <circle cx="384" cy="384" r="360" fill="none" stroke="#bfc7d6" stroke-width="24"/>
      <g>
        <path d="M240 200h160c96 0 160 64 160 152s-64 152-160 152H320v120h-80V200z" fill="#3aa0ff"/>
        <path d="M320 336l56 56 92-92 44 44 84-84" fill="none" stroke="#2b74c8" stroke-width="24" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M260 680v-110l120-120" fill="none" stroke="#2b74c8" stroke-width="22" stroke-linecap="round"/>
      </g>
    </g>
  </svg>`;
  return new Blob([svg], {type:"image/svg+xml"});
}

/* ---------- Build metadata JSON (generic or PXPX) ---------- */
async function buildAndUploadMetadata({name,symbol,story,nftKey,iconFile,isPXPX}) {
  // Ø¢ÛŒÚ©ÙˆÙ†: ÛŒØ§ ÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±ØŒ ÛŒØ§ SVG Ø¯Ø§Ø®Ù„ÛŒ PumpX
  let iconBlob = iconFile ? iconFile : pumpxSVG();
  const imageUri = await uploadNFTStorage(iconBlob, nftKey);

  const metadata = isPXPX ? {
    name: "PumpX Token",
    symbol: "PXPX",
    description: "The native utility token of PumpX â€” Create â€¢ Launch â€¢ Grow on Solana. Utility: fee discounts, staking boosts for Trending, governance, and community rewards.",
    image: imageUri,
    external_url: "https://pumpx.info",
    seller_fee_basis_points: 0,
    attributes: [
      {"trait_type":"role","value":"platform"},
      {"trait_type":"utility","value":"fees, staking boosts, governance, rewards"},
      {"trait_type":"network","value":"solana"},
      {"trait_type":"brand","value":"PumpX"}
    ],
    properties: {
      category:"image",
      files:[{uri:imageUri,type: iconFile ? iconFile.type : "image/svg+xml"}]
    },
    collection: {name:"PumpX Platform", family:"PumpX"}
  } : {
    name, symbol,
    description: story || `Token ${name} via PumpX`,
    image: imageUri,
    external_url: "https://pumpx.info",
    seller_fee_basis_points: 0,
    attributes: [
      {"trait_type":"created_via","value":"PumpX"},
      {"trait_type":"decimals","value": Number($("decimals").value || 9) }
    ],
    properties: {
      category:"image",
      files:[{uri:imageUri,type: iconFile ? iconFile.type : "image/svg+xml"}]
    }
  };

  const metaBlob = new Blob([JSON.stringify(metadata)], {type:"application/json"});
  const uri = await uploadNFTStorage(metaBlob, nftKey);
  return { imageUri, uri };
}

/* ---------- Create token + metadata ---------- */
$("createToken").onclick = async () => {
  if(!wallet||!provider) return alert("Ø§ÙˆÙ„ Ú©ÛŒÙ Ø±Ø§ ÙˆØµÙ„ Ú©Ù†ÛŒØ¯.");
  const name=$("name").value.trim(), symbol=$("symbol").value.trim();
  const decimals=Math.max(0,Math.min(9,parseInt($("decimals").value||"9",10)));
  const supplyHuman=Number($("supply").value||"0"); if(!(supplyHuman>0)) return alert("Ø¹Ø±Ø¶Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.");
  const iconFile=$("icon").files[0]||null, nftKey=$("nftkey").value.trim(), story=$("story").value.trim();
  if(!nftKey) return alert("NFT.Storage token Ù„Ø§Ø²Ù… Ø§Ø³Øª.");

  const signer={ publicKey:new PublicKey(wallet), signTransaction:(tx)=>provider.signTransaction(tx), signAllTransactions:(txs)=>provider.signAllTransactions(txs) };
  try{
    statusEl.textContent="Ø¢Ù¾Ù„ÙˆØ¯ Ù…ØªØ§Ø¯ÛŒØªØ§â€¦";
    const { uri } = await buildAndUploadMetadata({name,symbol,story,nftKey,iconFile,isPXPX:false});

    statusEl.textContent="Ø³Ø§Ø®Øª Mintâ€¦";
    const mintPk=await createMint(connection,signer,new PublicKey(wallet),new PublicKey(wallet),decimals,undefined,undefined,TOKEN_PROGRAM_ID);

    statusEl.textContent="Ø³Ø§Ø®Øª Ø­Ø³Ø§Ø¨ ØªÙˆÚ©Ù†â€¦";
    const ata=await getOrCreateAssociatedTokenAccount(connection,signer,mintPk,new PublicKey(wallet));

    statusEl.textContent="Ù…ÛŒÙ†Øª Ø¹Ø±Ø¶Ù‡ Ø§ÙˆÙ„ÛŒÙ‡â€¦";
    const amount=Math.round(supplyHuman*10**decimals);
    const sigMint=await mintTo(connection,signer,mintPk,ata.address,new PublicKey(wallet),amount);

    statusEl.textContent="Ø«Ø¨Øª Metadata Ø±ÙˆÛŒâ€ŒÚ†ÛŒÙ†â€¦";
    const umi=createUmi(RPCS[network][0]);
    umi.use(signerIdentity({ publicKey:umiPk(wallet), signTransaction:async(tx)=>provider.signTransaction(tx), signAllTransactions:async(txs)=>provider.signAllTransactions(txs) }));
    await createV1(umi,{ mint:umiPk(mintPk.toBase58()),authority:umiPk(wallet),payer:umiPk(wallet),updateAuthority:umiPk(wallet),name,symbol,uri,sellerFeeBasisPoints:0 }).sendAndConfirm(umi);

    const txUrl=`https://explorer.solana.com/tx/${sigMint}?cluster=${network==="devnet"?"devnet":""}`;
    const addrUrl=`https://explorer.solana.com/address/${mintPk.toBase58()}?cluster=${network==="devnet"?"devnet":""}`;
    const box=$("result"); box.style.display="block"; box.innerHTML=`
      <div><b>Mint:</b><div class="code">${mintPk.toBase58()}</div></div>
      <div><a target="_blank" href="${addrUrl}">Explorer</a> â€¢ <a target="_blank" href="${txUrl}">Transaction</a></div>
      <div class="row" style="margin-top:8px"><button id="buyPx" class="btn">Buy PXPX</button></div>`;
    statusEl.textContent="Ø¢Ù…Ø§Ø¯Ù‡ âœ…";
    await refreshBalance();

    // Ø«Ø¨Øª Ù…Ø­Ù„ÛŒ
    const reg=JSON.parse(localStorage.getItem("pumpx:list")||"[]");
    reg.unshift({ts:Date.now(),name,symbol,mint:mintPk.toBase58(),net:network});
    localStorage.setItem("pumpx:list",JSON.stringify(reg.slice(0,200)));
    renderExplore();
    // Ø¯Ú©Ù…Ù‡ Ø®Ø±ÛŒØ¯ PXPX
    document.getElementById("buyPx").onclick=()=>{$("jup").src="https://jup.ag/swap/SOL-PXPX";};
    $("lock").disabled=true; // Ù‚ÙÙ„ Ø¨Ø¹Ø¯ Ø§Ø² ØªØ§ÛŒÛŒØ¯ Ø¯Ø³ØªÛŒ Ø¨Ù‡ØªØ± Ø§Ø³Øª
  }catch(e){ console.error(e); statusEl.textContent="Ø®Ø·Ø§: "+(e?.message||e); }
};

/* ---------- One-click: Launch PXPX ---------- */
$("pxpx").onclick = async ()=>{
  // Ù¾Ø±Ú©Ø±Ø¯Ù† ÙØ±Ù…
  $("name").value="PumpX Token"; $("symbol").value="PXPX";
  $("decimals").value=9; $("supply").value=1000000000;
  $("story").value="The native utility token of PumpX â€” Create â€¢ Launch â€¢ Grow on Solana.";
  if(!$("nftkey").value.trim()) return alert("NFT.Storage token Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ØŒ Ø³Ù¾Ø³ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±ÙˆÛŒ Launch Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.");

  // Ø§Ø¬Ø±Ø§ Ù…Ø«Ù„ createToken ÙˆÙ„ÛŒ Ø¨Ø§ SVG Ø¯Ø§Ø®Ù„ÛŒ Ùˆ Ù…ØªØ§Ø¯ÛŒØªØ§ÛŒ ÙˆÛŒÚ˜Ù‡
  $("createToken").click();
};

/* ---------- Lock mint (Ø§Ø®ØªÛŒØ§Ø±ÛŒ) ---------- */
$("lock").onclick=async ()=>{
  const mintAddr = $("result").textContent.match(/[1-9A-HJ-NP-Za-km-z]{32,44}/)?.[0];
  if(!mintAddr||!wallet||!provider) return;
  try{
    statusEl.textContent="Ù‚ÙÙ„â€ŒÚ©Ø±Ø¯Ù† Mintâ€¦";
    const signer={ publicKey:new PublicKey(wallet), signTransaction:(tx)=>provider.signTransaction(tx), signAllTransactions:(txs)=>provider.signAllTransactions(txs) };
    await setAuthority(connection,signer,new PublicKey(mintAddr),new PublicKey(wallet),AuthorityType.MintTokens,null);
    statusEl.textContent="Mint Ù‚ÙÙ„ Ø´Ø¯ ğŸ”’";
  }catch(e){ statusEl.textContent="Ø®Ø·Ø§: "+(e?.message||e); }
};

/* ---------- Explore (local) ---------- */
function renderExplore(){
  const el=$("explist"); el.innerHTML="";
  const data=(JSON.parse(localStorage.getItem("pumpx:list")||"[]")).slice(0,60);
  if(!data.length){el.innerHTML='<div class="muted">ÙØ¹Ù„Ø§Ù‹ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</div>';return;}
  for(const it of data){
    const card=document.createElement("div"); card.className="card-sm";
    const url=`https://explorer.solana.com/address/${it.mint}?cluster=${it.net==="devnet"?"devnet":""}`;
    card.innerHTML=`<div><b>${it.name}</b> <span class="badge">${it.symbol}</span></div>
    <div class="muted">${new Date(it.ts).toLocaleString()}</div>
    <div class="code">${it.mint}</div>
    <div class="row" style="margin-top:8px">
      <a class="btn" target="_blank" href="${url}">Explorer</a>
      <button class="btn" data-mint="${it.mint}">Set in Swap</button>
    </div>`;
    card.querySelector("button").onclick=()=>{ $("swapMint").value=it.mint; setSwapPair(); };
    el.appendChild(card);
  }
}
$("refreshLocal").onclick=renderExplore; renderExplore();

/* ---------- Swap ---------- */
function setSwapPair(){ const mint=$("swapMint").value.trim(); if(mint){ $("jup").src=`https://jup.ag/swap/SOL-${mint}`; } }
$("setSwap").onclick=setSwapPair;
$("setPXPX").onclick=()=>{$("jup").src="https://jup.ag/swap/SOL-PXPX";};

/* ---------- AI (Ø§Ø®ØªÛŒØ§Ø±ÛŒ) ---------- */
async function aiChat(key, prompt){
  if(!key){
    const seeds=["Nova","Flux","Neon","Astra","Pulse","Quark"];
    const name=`${seeds[Math.random()*seeds.length|0]} Token`;
    const symbol=("PX"+(Math.random()*100|0)).slice(0,4).toUpperCase();
    const story=`${name}: ØªÙˆÚ©Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ø§Ù…Ø¹Ù‡â€ŒØ§ÛŒ Ù¾Ø±Ø§Ù†Ø±Ú˜ÛŒ.`;
    return {options:[{name,symbol,story}],warnings:["Ù‚ÙˆÙ„ Ø³ÙˆØ¯ Ù†Ø¯Ù‡ÛŒØ¯","Mint Ø±Ø§ Ù‚ÙÙ„ Ú©Ù†ÛŒØ¯"]};
  }
  const r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"content-type":"application/json","authorization":"Bearer "+key},body:JSON.stringify({model:"gpt-4o-mini",temperature:0.8,messages:[{role:"system",content:"You are PumpX growth assistant. Return concise JSON only."},{role:"user",content:prompt}]})});
  const j=await r.json(); const txt=j?.choices?.[0]?.message?.content||"{}"; const m=txt.match(/\{[\s\S]*\}/);
  try{return JSON.parse(m?m[0]:txt);}catch{return {raw:txt};}
}
$("aiBrand").onclick=async()=>{ $("aiStatus").textContent="Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯â€¦"; const out=await aiChat($("openai").value.trim(),`Suggest 3 options: {name<=16, symbol=2-4 caps, story 1 sentence}. Theme: ${$("theme").value}. Return {"options":[...]}.`); const o=out?.options?.[0]||out; if(o?.name)$("name").value=o.name; if(o?.symbol)$("symbol").value=o.symbol; if(o?.story)$("story").value=o.story; $("aiStatus").textContent="Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯ âœ…"; };
$("aiRisk").onclick=async()=>{ $("aiStatus").textContent="ØªØ­Ù„ÛŒÙ„â€¦"; const out=await aiChat($("openai").value.trim(),`Analyze risks and trust-boosters for: ${$("desc").value||$("story").value}. Return {"warnings":["..."],"trust_boosters":["..."]}`); $("riskOut").style.display="block"; $("riskOut").innerHTML=`<div><b>Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§</b><ul>${(out?.warnings||[]).map(x=>`<li>${x}</li>`).join("")||"<li>â€”</li>"}</ul></div><div><b>ØªÙ‚ÙˆÛŒØª Ø§Ø¹ØªÙ…Ø§Ø¯</b><ul>${(out?.trust_boosters||[]).map(x=>`<li>${x}</li>`).join("")||"<li>â€”</li>"}</ul></div>`; $("aiStatus").textContent="ØªÙ…Ø§Ù… âœ…"; };

/* ---------- Auto (silent) ---------- */
window.addEventListener("load",async()=>{ provEl.textContent=getProvider()?"OK âœ…":"Not found âŒ"; await new Promise(r=>setTimeout(r,300)); try{const p=getProvider(); if(p){const r=await p.connect?.({onlyIfTrusted:true}); if(r?.publicKey){ wallet=r.publicKey.toString(); addrEl.textContent=wallet; $("connect").style.display="none"; $("disconnect").style.display="inline-block"; $("createToken").disabled=false; await refreshBalance(); }}}catch{};});
</script>
</body>
</html>
