<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PumpX • ساخت توکن سولانا</title>
  <meta name="description" content="PumpX — ساخت و لانچ توکن روی Solana با اتصال Phantom"/>
  <link rel="preconnect" href="https://esm.sh"/>
  <style>
    :root{
      --bg:#0b0f1a;--card:#0f1524;--line:#23304c;--muted:#9aa3b2;
      --g1:linear-gradient(90deg,#12f0ff55,#7a5cff44,#ff3ef644);
    }
    *{box-sizing:border-box}html,body{margin:0;height:100%}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Arabic",sans-serif;
      background:radial-gradient(1200px 600px at 10% -10%,#7a5cff22,transparent),
                 radial-gradient(800px 500px at 110% 20%,#ff3ef622,transparent),
                 var(--bg);color:#fff}
    .wrap{max-width:1100px;margin:auto;padding:24px}
    .nav{position:sticky;top:0;z-index:40;backdrop-filter:blur(8px);
      background:#0b0f1acc;border-bottom:1px solid #ffffff18}
    .navin{display:flex;align-items:center;justify-content:space-between;height:64px}
    .logo{display:flex;align-items:center;gap:10px;cursor:default}
    .mark{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;
      border:1px solid #ffffff22;background:var(--g1);font-weight:900}
    .btn{background:var(--g1);border:1px solid #ffffff22;color:#fff;cursor:pointer;
      padding:10px 14px;border-radius:12px}
    .btn:hover{filter:brightness(1.1)}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .hero{display:grid;gap:18px;margin:28px 0 18px}
    .title{font-weight:900;font-size:clamp(32px,4vw,54px);line-height:1.15}
    .subtitle{color:#cfe1ff;opacity:.85;max-width:720px}
    .card{background:#0f1524cc;border:1px solid #ffffff22;border-radius:20px;padding:18px;box-shadow:0 10px 40px #0006}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(max-width:700px){.grid{grid-template-columns:1fr}}
    label{display:flex;flex-direction:column;gap:6px;font-size:14px;color:#cfd6e4}
    input,select{background:#121a2c;color:#fff;border:1px solid var(--line);
      border-radius:12px;padding:10px 12px;font-size:14px}
    .status{font-size:13px;opacity:.8}
    .result{margin-top:14px;padding:12px;border-radius:14px;border:1px dashed #ffffff22;background:#0005;word-break:break-all}
    .footer{opacity:.75;font-size:12px;margin-top:10px}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid #ffffff22;background:#ffffff10;font-size:12px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="wrap navin">
      <div class="logo">
        <div class="mark">P</div>
        <div style="font-weight:900;letter-spacing:.12em">PumpX</div>
      </div>
      <div class="row">
        <select id="network">
          <option value="devnet" selected>Devnet</option>
          <option value="mainnet-beta">Mainnet</option>
        </select>
        <button id="connect" class="btn">اتصال به Phantom</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- HERO -->
    <section class="hero">
      <div class="title">ساخت و لانچ توکن روی Solana — سریع، زیبا، حرفه‌ای</div>
      <div class="subtitle">این نسخهٔ بدون بیلد برای GitHub Pages طراحی شده: اتصال Phantom، ساخت
        SPL Token روی Devnet و نمایش لینک اکسپلورر. نسخهٔ کامل (Metadata/IPFS/Presale) در گام بعد.</div>
      <div class="row">
        <div class="pill">UI شیشه‌ای/نئونی</div>
        <div class="pill">Phantom Ready</div>
        <div class="pill">Devnet First</div>
      </div>
    </section>

    <!-- CREATE TOKEN -->
    <section class="card">
      <h2 style="margin:0 0 10px;font-size:18px">فرم ساخت توکن</h2>
      <div class="grid">
        <label>نام (UI)
          <input id="name" value="PumpX Token"/>
        </label>
        <label>نماد (Symbol)
          <input id="symbol" value="PXP"/>
        </label>
        <label>Decimals
          <input id="decimals" type="number" min="0" max="9" value="9"/>
        </label>
        <label>عرضه اولیه (به واحد انسانی)
          <input id="supply" type="number" value="1000000"/>
        </label>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="create" class="btn" disabled>ساخت توکن</button>
        <span id="status" class="status"></span>
      </div>

      <div id="result" class="result" style="display:none"></div>
      <div class="footer">نکته: این نسخهٔ MVP متادیتای روی‌چین را ثبت نمی‌کند. نسخهٔ بعدی با
        <b>Token Metadata Program</b> (نام/نماد/آیکون روی IPFS/Arweave) عرضه می‌شود.</div>
    </section>
  </div>

  <!-- APP (No build. ESM imports) -->
  <script type="module">
    import { Connection, clusterApiUrl, PublicKey } from "https://esm.sh/@solana/web3.js@1.95.3";
    import { createMint, getOrCreateAssociatedTokenAccount, mintTo, TOKEN_PROGRAM_ID }
      from "https://esm.sh/@solana/spl-token@0.4.6?bundle";

    const $ = id => document.getElementById(id);
    const statusEl = $("status"), resultEl = $("result"), connectBtn = $("connect");
    const networkSel = $("network"), createBtn = $("create");
    let wallet = null, network = "devnet", connection = new Connection(clusterApiUrl(network), "confirmed");

    // network switch
    networkSel.addEventListener("change", e=>{
      network = e.target.value; connection = new Connection(clusterApiUrl(network), "confirmed");
    });

    // connect phantom
    connectBtn.addEventListener("click", async ()=>{
      try{
        if(!window.solana || !window.solana.isPhantom){ alert("Phantom نصب نیست"); return; }
        const resp = await window.solana.connect();
        wallet = new PublicKey(resp.publicKey.toString());
        connectBtn.textContent = `متصل: ${wallet.toBase58().slice(0,4)}…${wallet.toBase58().slice(-4)}`;
        createBtn.disabled = false;
      }catch(e){ console.error(e); alert("اتصال ناموفق بود"); }
    });

    // create token
    createBtn.addEventListener("click", async ()=>{
      if(!wallet) return alert("ابتدا به Phantom وصل شوید.");
      const name = $("name").value.trim();
      const symbol = $("symbol").value.trim();
      const decimals = Math.max(0, Math.min(9, parseInt($("decimals").value||"9",10)));
      const supplyHuman = Number($("supply").value||"0"); if(!(supplyHuman>0)) return alert("عرضه اولیه معتبر نیست.");
      try{
        setStatus("ایجاد Mint…");
        const provider = window.solana;
        const signer = {
          publicKey: wallet,
          signTransaction: tx => provider.signTransaction(tx),
          signAllTransactions: txs => provider.signAllTransactions(txs)
        };
        const mintPk = await createMint(connection, signer, wallet, wallet, decimals, undefined, undefined, TOKEN_PROGRAM_ID);

        setStatus("ساخت حساب توکن (ATA)...");
        const ata = await getOrCreateAssociatedTokenAccount(connection, signer, mintPk, wallet);

        setStatus("مینت عرضه اولیه…");
        const amount = Math.round(supplyHuman * 10**decimals);
        const sig = await mintTo(connection, signer, mintPk, ata.address, wallet, amount);

        setStatus("انجام شد ✅");
        const txUrl = `https://explorer.solana.com/tx/${sig}?cluster=${network==="devnet"?"devnet":""}`;
        const addrUrl = `https://explorer.solana.com/address/${mintPk.toBase58()}?cluster=${network==="devnet"?"devnet":""}`;
        resultEl.style.display = "block";
        resultEl.innerHTML = `
          <div>نام/نماد (UI): <b>${name}</b> (${symbol})</div>
          <div>آدرس مینت: <code>${mintPk.toBase58()}</code></div>
          <div><a target="_blank" href="${addrUrl}">مشاهده Mint در Explorer</a> •
              <a target="_blank" href="${txUrl}">تراکنش</a></div>`;
      }catch(e){
        console.error(e); setStatus("خطا"); alert(e?.message||e);
      }
    });

    function setStatus(t){ statusEl.textContent = t; }
  </script>
</body>
</html>
